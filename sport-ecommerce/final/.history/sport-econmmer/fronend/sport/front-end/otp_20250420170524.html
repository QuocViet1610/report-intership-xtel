<!DOCTYPE html>
<html lang="en">



<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../assets/images/logo/logoHeader1.png?v=1" type="image/png">
    <title>GOFIT</title>


    <!-- Google font -->
    <link rel="preconnect" href="https://fonts.gstatic.com/">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap">

    <!-- bootstrap css -->
    <link id="rtl-link" rel="stylesheet" type="text/css" href="../assets/css/vendors/bootstrap.css">

    <!-- Iconly css -->
    <link rel="stylesheet" type="text/css" href="../assets/css/bulk-style.css">

    <!-- Template css -->
    <link id="color-link" rel="stylesheet" type="text/css" href="../assets/css/style.css">
    <style>
        .form-control {
            border: 1px solid #ccc !important; /* Viền màu xám nhạt */
            border-radius: 5px; /* Bo tròn góc */
               }
            .log-in-button li{
                border: 1px solid #ccc !important; /* Viền màu xám nhạt */
                border-radius: 5px; /* Bo tròn góc */
            }
            .log-in-box{
                background: white !important; 
            }
    
            #countdown {
                font-size: 16px;
                color: var(--theme-color);
            }
    </style>
</head>

<body>

    <!-- Loader Start -->
    <div class="fullpage-loader">
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
    </div>
    <!-- Loader End -->



    <!-- mobile fix menu start -->
    <!-- mobile fix menu end -->


    <!-- Breadcrumb Section End -->

    <!-- log in section start -->
    <section class="log-in-section otp-section section-b-space" style="width: 100vw; height: 100vh; padding: 0px;">
        <div class="container-fluid h-100">
            <div class="row h-100">
                <!-- Cột trái: ảnh -->
                <div class="col-lg-8 col-md-8 p-0 d-md-block d-none">
                    <div class="image-contain h-100 w-100">
                        <img src="https://thethemedemo.com/fitzoon/wp-content/uploads/revslider/home-1/4s-1.jpg"
                             class="img-fluid"
                             style="width: 100%; height: 100%; object-fit: cover;" 
                             alt="OTP background">
                    </div>
                </div>
    
                <!-- Cột phải: form OTP -->
                <div class="col-lg-4 col-md-4 d-flex align-items-center justify-content-center">
                    <div class="log-in-box">
                        <div class="log-in-title mb-4">
                            <h3 class="text-title">Xác nhận tài khoản của bạn</h3>
                            <h5 class="text-content">Mã OTP đã được gửi đến địa chỉ <span class="maskedEmail ">*******32@gmail.com</span></h5>
                        </div>
    
                        <div id="otp" class="inputs d-flex flex-row justify-content-center gap-2 mb-3">
                            <input class="text-center form-control rounded" type="text" id="first" maxlength="1" placeholder="0">
                            <input class="text-center form-control rounded" type="text" id="second" maxlength="1" placeholder="0">
                            <input class="text-center form-control rounded" type="text" id="third" maxlength="1" placeholder="0">
                            <input class="text-center form-control rounded" type="text" id="fourth" maxlength="1" placeholder="0">
                            <input class="text-center form-control rounded" type="text" id="fifth" maxlength="1" placeholder="0">
                            <input class="text-center form-control rounded" type="text" id="sixth" maxlength="1" placeholder="0">
                        </div>
    
                        <div class="send-box pt-3 mb-3">
                            <h6>Bạn đã nhận được mã? <a href="javascript:void(0)" class="theme-color fw-bold" id="resend-otp">Gửi lại</a></h6>
                            <p id="countdown" style="display:none;"></p>
                        </div>
    
                        <button class="btn btn-animation w-100 btn-confirm" type="submit">
                            Xác nhận
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
      
    <!-- log in section end -->



    <!-- Tap to top and theme setting button start -->
    <div class="theme-option">
        <div class="setting-box">
            <button class="btn setting-button">
                <i class="fa-solid fa-gear"></i>
            </button>

            <div class="theme-setting-2">
                <div class="theme-box">
                    <ul>
                        <li>
                            <div class="setting-name">
                                <h4>Color</h4>
                            </div>
                            <div class="theme-setting-button color-picker">
                                <form class="form-control">
                                    <label for="colorPick" class="form-label mb-0">Theme Color</label>
                                    <input type="color" class="form-control form-control-color" id="colorPick"
                                        value="#0da487" title="Choose your color">
                                </form>
                            </div>
                        </li>

                        <li>
                            <div class="setting-name">
                                <h4>Dark</h4>
                            </div>
                            <div class="theme-setting-button">
                                <button class="btn btn-2 outline" id="darkButton">Dark</button>
                                <button class="btn btn-2 unline" id="lightButton">Light</button>
                            </div>
                        </li>

                        <li>
                            <div class="setting-name">
                                <h4>RTL</h4>
                            </div>
                            <div class="theme-setting-button rtl">
                                <button class="btn btn-2 rtl-unline">LTR</button>
                                <button class="btn btn-2 rtl-outline">RTL</button>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="back-to-top">
            <a id="back-to-top" href="#">
                <i class="fas fa-chevron-up"></i>
            </a>
        </div>
    </div>
    <!-- Tap to top and theme setting button end -->

    <!-- Bg overlay Start -->
    <div class="bg-overlay"></div>
    <!-- Bg overlay End -->

    <!-- latest jquery-->
    <script src="../assets/js/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap js-->
    <script src="../assets/js/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="../assets/js/bootstrap/popper.min.js"></script>

    <!-- otp js-->
    <script src="../assets/js/otp.js"></script>

    <!-- Slick js-->
    <script src="../assets/js/slick/slick.js"></script>
    <script src="../assets/js/slick/slick-animation.min.js"></script>
    <script src="../assets/js/slick/custom_slick.js"></script>

    <!-- feather icon js-->
    <script src="../assets/js/feather/feather.min.js"></script>
    <script src="../assets/js/feather/feather-icon.js"></script>

    <!-- Lazyload Js -->
    <script src="../assets/js/lazysizes.min.js"></script>

    <!-- script js -->
    <script src="../assets/js/script.js"></script>
</body>

<script>
    $(document).ready(function() {

        $("#first, #second, #third, #fourth, #fifth, #sixth").on("input", function() {
            // Nếu ô hiện tại có giá trị, chuyển focus sang ô tiếp theo
            if (this.value.length === 1) {
                var nextInput = $(this).next("input");
                if (nextInput.length) {
                    nextInput.focus(); // Chuyển tới ô tiếp theo
                }
            }
        });
        

        $("#first, #second, #third, #fourth, #fifth, #sixth").on("keydown", function(e) {
            if (e.key === "Backspace") {

                if (this.value === "") {
                    var prevInput = $(this).prev("input");
                    if (prevInput.length) {
                        prevInput.focus(); 
                    }
                }

            }
        });

        // gui lai ma 
        var savedCountdown = localStorage.getItem('otpCountdown');
        if (savedCountdown) {
            var countdown = parseInt(savedCountdown);
            var countdownDisplay = $("#countdown");
            countdownDisplay.show().text("Bạn có thể gửi lại sau " + countdown + " giây.");
    
            var interval = setInterval(function() {
                countdown--;
                countdownDisplay.text("Bạn có thể gửi lại sau " + countdown + " giây.");
    
                localStorage.setItem('otpCountdown', countdown);
    
                if (countdown <= 0) {
                    clearInterval(interval);
                    countdownDisplay.hide();
                    $("#resend-otp").show();
                    localStorage.removeItem('otpCountdown'); 
                    $("#resend-otp").text("Gửi lại"); 
                }
            }, 1000);
            $("#resend-otp").hide(); 
        }
    
        $("#resend-otp").click(function() {
            sendOtpRequest(); 
            // Thay đổi nội dung khi bấm nút "Gửi lại"
            $("h6").html("Mã đã được gửi lại");
    
            // Thực hiện đếm ngược lại
            var countdown = 60; 
            var countdownDisplay = $("#countdown");
            countdownDisplay.show().text("Bạn có thể gửi lại sau " + countdown + " giây.");
    
            // Lưu countdown vào localStorage khi bắt đầu
            localStorage.setItem('otpCountdown', countdown);
    
            var interval = setInterval(function() {
                countdown--;
                countdownDisplay.text("Bạn có thể gửi lại sau " + countdown + " giây.");
    
                // Lưu lại countdown vào localStorage sau mỗi giây
                localStorage.setItem('otpCountdown', countdown);
    
                if (countdown <= 0) {
                    clearInterval(interval); 
                    countdownDisplay.hide(); 
                    $("#resend-otp").show(); 
                    localStorage.removeItem('otpCountdown'); 
                    $("#resend-otp").text("Gửi lại"); 
                }
            }, 1000); 
            $(this).hide(); // Ẩn nút "Gửi lại" khi bấm
        });
 
        var otpSend = localStorage.getItem("otpSent"); 
        if (otpSend === "true") {
            sendOtpRequest(); 
            console.log("test")
            localStorage.setItem("otpSent", "false"); 
        }
        var registerData = localStorage.getItem("registerRequest");
    
        // Kiểm tra nếu có dữ liệu trong localStorage
        if (registerData) {
            registerData = JSON.parse(registerData);
    
            // Điền thông tin vào các trường nhập liệu
            $("#fullname").val(registerData.fullName);
            $("#email").val(registerData.email);
            $("#phone").val(registerData.phone);
            $("#password").val(registerData.password);
            $("#passwordConfirm").val(registerData.passwordConfirm);
            var email = registerData.email;
            var maskedEmail = email.substring(0, 3) + "****" + email.substring(email.indexOf("@") - 2);
            $(".maskedEmail ").text(maskedEmail);}
        

// comfirm ##########################################
$(".btn-confirm").click(function() {
    // Lấy các giá trị OTP từ các ô nhập liệu
    var otp = "";
    otp += $("#first").val();
    otp += $("#second").val();
    otp += $("#third").val();
    otp += $("#fourth").val();
    otp += $("#fifth").val();
    otp += $("#sixth").val();

    // Kiểm tra xem OTP có đầy đủ chưa
    if (otp.length === 6) {
        var registerData = localStorage.getItem("registerRequest");
        registerData = JSON.parse(registerData);
        $("#email").val(registerData.email);
        var email = registerData.email;
        console.log(email)
        // Gọi API xác nhận OTP
        $.ajax({
            url: "http://localhost:8080/auth/verify-otp", 
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({
                email: email,  // Lấy email từ localStorage
                otp: otp       // Gửi OTP nhập vào
            }),
            success: function(response) {
                if (response.code === "200") { 
                    if (response.data) {
                        showSuccess("Đăng ký thành công!");
                        // Chuyển hướng đến trang login sau 1 giây
                        setTimeout(function() {
                            localStorage.removeItem("registerRequest");
                            window.location.href = "login.html"; 
                        }, 1000); // Delay 1 giây
                
                    }
                } else {
                    showError(response.message || "Mã đăng OTP sai! Vui lòng kiểm tra lại.");
                }
            },
            error: function(xhr) {
                if (xhr.responseJSON && xhr.responseJSON.message) {
                    showError(xhr.responseJSON.message); 
                } else {
                    showError("Mã đăng OTP sai! Vui lòng kiểm tra lại.");
                }
            }
        });
    } else {
        showError("Vui lòng nhập đầy đủ mã OTP.");
    }
});
    

    });


    function sendOtpRequest() {
      
        var registerData = localStorage.getItem("registerRequest");
    
        // Kiểm tra nếu có dữ liệu trong localStorage
        if (registerData) {
            registerData = JSON.parse(registerData);
    
            // Điền thông tin vào các trường nhập liệu
            $("#fullname").val(registerData.fullName);
            $("#email").val(registerData.email);
            $("#phone").val(registerData.phone);
            $("#password").val(registerData.password);
            $("#passwordConfirm").val(registerData.passwordConfirm);
            var email = registerData.email;
            var maskedEmail = email.substring(0, 3) + "****" + email.substring(email.indexOf("@") - 2);
            $(".maskedEmail ").text(maskedEmail);
            // Gửi yêu cầu OTP
            $.ajax({
                url: "http://localhost:8080/auth/send-otp", // Đảm bảo URL đúng
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(registerData), // Chuyển đổi dữ liệu thành chuỗi JSON
                success: function(response) {
                    console.log("Success response:", response);
                    if (response.code === "200") {
                        if (response.data) {
                            console.log(esponse.data)
                        }
                    } else {
                        showError(response.message || "Đăng ký thất bại!");
                    }
                },
                error: function(xhr) {
                    console.log("Error response:", xhr);
                    if (xhr.responseJSON && xhr.responseJSON.message) {
                        showError(xhr.responseJSON.message);
                    } else {
                        showError("Đăng ký thất bại! Vui lòng kiểm tra lại.");
                    }
                }
            });
        } else {
            showError("Bạn chưa đăng ký! Vui lòng kiểm tra lại.");
        }
    }
</script>

</html>